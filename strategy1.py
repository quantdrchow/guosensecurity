# -*- coding: utf-8 -*-
"""
先把框架搭好。
@author: zhouxianzheng
"""

# import tensorflow.compat.v1 as tf
# tf.disable_v2_behavior()
import numpy as np
import pandas as pd
import pickle as cp
from datetime import datetime
import statsmodels.api as sm
import gc
# from __future__ import print_function
import keras
from keras.datasets import mnist
from keras.models import Sequential,load_model
from keras.layers import Dense, Dropout, BatchNormalization, Activation
from keras.optimizers import RMSprop
import time
import matplotlib.pyplot as plt

# 1.输入
def getalpha():
    alpha001 = pd.read_pickle('E:/data/guotaijunanmiddle/alphastandardizedzscore/alpha001.pkl'), print('alpha001');
    alpha002 = pd.read_pickle('E:/data/guotaijunanmiddle/alphastandardizedzscore/alpha002.pkl'), print('alpha002');
    alpha003 = pd.read_pickle('E:/data/guotaijunanmiddle/alphastandardizedzscore/alpha003.pkl'), print('alpha003');
    alpha004 = pd.read_pickle('E:/data/guotaijunanmiddle/alphastandardizedzscore/alpha004.pkl'), print('alpha004');
    alpha005 = pd.read_pickle('E:/data/guotaijunanmiddle/alphastandardizedzscore/alpha005.pkl'), print('alpha005');
    alpha006 = pd.read_pickle('E:/data/guotaijunanmiddle/alphastandardizedzscore/alpha006.pkl'), print('alpha006');
    alpha007 = pd.read_pickle('E:/data/guotaijunanmiddle/alphastandardizedzscore/alpha007.pkl'), print('alpha007');
    alpha008 = pd.read_pickle('E:/data/guotaijunanmiddle/alphastandardizedzscore/alpha008.pkl'), print('alpha008');
    alpha009 = pd.read_pickle('E:/data/guotaijunanmiddle/alphastandardizedzscore/alpha009.pkl'), print('alpha009');
    alpha010 = pd.read_pickle('E:/data/guotaijunanmiddle/alphastandardizedzscore/alpha010.pkl'), print('alpha010');
    alpha011 = pd.read_pickle('E:/data/guotaijunanmiddle/alphastandardizedzscore/alpha011.pkl'), print('alpha011');
    alpha012 = pd.read_pickle('E:/data/guotaijunanmiddle/alphastandardizedzscore/alpha012.pkl'), print('alpha012');
    alpha013 = pd.read_pickle('E:/data/guotaijunanmiddle/alphastandardizedzscore/alpha013.pkl'), print('alpha013');
    alpha014 = pd.read_pickle('E:/data/guotaijunanmiddle/alphastandardizedzscore/alpha014.pkl'), print('alpha014');
    alpha015 = pd.read_pickle('E:/data/guotaijunanmiddle/alphastandardizedzscore/alpha015.pkl'), print('alpha015');
    alpha016 = pd.read_pickle('E:/data/guotaijunanmiddle/alphastandardizedzscore/alpha016.pkl'), print('alpha016');
    alpha017 = pd.read_pickle('E:/data/guotaijunanmiddle/alphastandardizedzscore/alpha017.pkl'), print('alpha017');
    alpha018 = pd.read_pickle('E:/data/guotaijunanmiddle/alphastandardizedzscore/alpha018.pkl'), print('alpha018');
    alpha019 = pd.read_pickle('E:/data/guotaijunanmiddle/alphastandardizedzscore/alpha019.pkl'), print('alpha019');
    alpha020 = pd.read_pickle('E:/data/guotaijunanmiddle/alphastandardizedzscore/alpha020.pkl'), print('alpha020');
    alpha021 = pd.read_pickle('E:/data/guotaijunanmiddle/alphastandardizedzscore/alpha021.pkl'), print('alpha021');
    alpha022 = pd.read_pickle('E:/data/guotaijunanmiddle/alphastandardizedzscore/alpha022.pkl'), print('alpha022');
    alpha023 = pd.read_pickle('E:/data/guotaijunanmiddle/alphastandardizedzscore/alpha023.pkl'), print('alpha023');
    alpha024 = pd.read_pickle('E:/data/guotaijunanmiddle/alphastandardizedzscore/alpha024.pkl'), print('alpha024');
    alpha025 = pd.read_pickle('E:/data/guotaijunanmiddle/alphastandardizedzscore/alpha025.pkl'), print('alpha025');
    alpha026 = pd.read_pickle('E:/data/guotaijunanmiddle/alphastandardizedzscore/alpha026.pkl'), print('alpha026');
    alpha027 = pd.read_pickle('E:/data/guotaijunanmiddle/alphastandardizedzscore/alpha027.pkl'), print('alpha027');
    alpha029 = pd.read_pickle('E:/data/guotaijunanmiddle/alphastandardizedzscore/alpha029.pkl'), print('alpha029');
    alpha031 = pd.read_pickle('E:/data/guotaijunanmiddle/alphastandardizedzscore/alpha031.pkl'), print('alpha031');
    alpha032 = pd.read_pickle('E:/data/guotaijunanmiddle/alphastandardizedzscore/alpha032.pkl'), print('alpha032');
    return alpha001,alpha002,alpha003,alpha004,alpha005,alpha006,alpha007,alpha008,alpha009,alpha010,alpha011,alpha012,alpha013,alpha014,alpha015,alpha016,alpha017,alpha018,alpha019,alpha020,alpha021,alpha022,alpha023,alpha024,alpha025,alpha026,alpha027,alpha029,alpha031,alpha032
def getinputdata():
    alphaall = ['alpha001', 'alpha002', 'alpha003', 'alpha004', 'alpha005', 'alpha006', 'alpha007', 'alpha008', 'alpha009', 'alpha010', 'alpha011', 'alpha012', 'alpha013', 'alpha014', 'alpha015', 'alpha016', 'alpha017', 'alpha018', 'alpha019', 'alpha020', 'alpha021', 'alpha022', 'alpha023', 'alpha024', 'alpha025', 'alpha026', 'alpha027', 'alpha029', 'alpha031', 'alpha032', 'alpha033', 'alpha034', 'alpha035', 'alpha036', 'alpha037', 'alpha038', 'alpha039', 'alpha041', 'alpha042', 'alpha044', 'alpha045', 'alpha047', 'alpha048', 'alpha049', 'alpha050', 'alpha051', 'alpha052', 'alpha053', 'alpha054', 'alpha055', 'alpha056', 'alpha058', 'alpha059', 'alpha060', 'alpha061', 'alpha062', 'alpha063', 'alpha064', 'alpha065', 'alpha067', 'alpha068', 'alpha069', 'alpha070', 'alpha071', 'alpha072', 'alpha073', 'alpha074', 'alpha075', 'alpha076', 'alpha077', 'alpha079', 'alpha080', 'alpha081', 'alpha082', 'alpha083', 'alpha084', 'alpha085', 'alpha086', 'alpha087', 'alpha089', 'alpha090', 'alpha091', 'alpha092', 'alpha093', 'alpha094', 'alpha095', 'alpha098', 'alpha099', 'alpha101', 'alpha102', 'alpha103', 'alpha104', 'alpha105', 'alpha106', 'alpha107', 'alpha108', 'alpha109', 'alpha110', 'alpha111', 'alpha112', 'alpha113', 'alpha114', 'alpha115', 'alpha116', 'alpha117', 'alpha118', 'alpha119', 'alpha120', 'alpha121', 'alpha122', 'alpha123', 'alpha124', 'alpha125', 'alpha126', 'alpha127', 'alpha128', 'alpha129', 'alpha130', 'alpha131', 'alpha132', 'alpha133', 'alpha134', 'alpha135', 'alpha136', 'alpha137', 'alpha138', 'alpha139', 'alpha140', 'alpha141', 'alpha142', 'alpha144', 'alpha145', 'alpha146', 'alpha147', 'alpha148', 'alpha150', 'alpha151', 'alpha152', 'alpha154', 'alpha155', 'alpha156', 'alpha157', 'alpha158', 'alpha159', 'alpha160', 'alpha161', 'alpha162', 'alpha163', 'alpha164', 'alpha165', 'alpha166', 'alpha167', 'alpha168', 'alpha169', 'alpha170', 'alpha171', 'alpha173', 'alpha174', 'alpha175', 'alpha176', 'alpha177', 'alpha178', 'alpha179', 'alpha180', 'alpha181', 'alpha182', 'alpha183', 'alpha184', 'alpha185', 'alpha187', 'alpha188', 'alpha189', 'alpha190', 'alpha191']
    stock_zz800_list = ['000001.SZ', '000002.SZ', '000006.SZ', '000008.SZ', '000009.SZ', '000012.SZ', '000021.SZ', '000025.SZ', '000027.SZ', '000028.SZ', '000031.SZ', '000039.SZ', '000049.SZ', '000050.SZ', '000060.SZ', '000061.SZ', '000062.SZ', '000063.SZ', '000066.SZ', '000069.SZ', '000078.SZ', '000089.SZ', '000090.SZ', '000099.SZ', '000100.SZ', '000156.SZ', '000157.SZ', '000158.SZ', '000166.SZ', '000333.SZ', '000338.SZ', '000400.SZ', '000401.SZ', '000402.SZ', '000413.SZ', '000415.SZ', '000417.SZ', '000418.SZ', '000423.SZ', '000425.SZ', '000426.SZ', '000488.SZ', '000501.SZ', '000503.SZ', '000513.SZ', '000517.SZ', '000519.SZ', '000528.SZ', '000536.SZ', '000538.SZ', '000540.SZ', '000541.SZ', '000543.SZ', '000547.SZ', '000552.SZ', '000555.SZ', '000559.SZ', '000563.SZ', '000566.SZ', '000568.SZ', '000572.SZ', '000581.SZ', '000587.SZ', '000592.SZ', '000596.SZ', '000598.SZ', '000600.SZ', '000612.SZ', '000616.SZ', '000620.SZ', '000623.SZ', '000625.SZ', '000627.SZ', '000630.SZ', '000636.SZ', '000651.SZ', '000652.SZ', '000656.SZ', '000661.SZ', '000662.SZ', '000667.SZ', '000669.SZ', '000671.SZ', '000680.SZ', '000681.SZ', '000685.SZ', '000686.SZ', '000690.SZ', '000697.SZ', '000703.SZ', '000709.SZ', '000712.SZ', '000718.SZ', '000725.SZ', '000726.SZ', '000727.SZ', '000728.SZ', '000729.SZ', '000732.SZ', '000738.SZ', '000750.SZ', '000758.SZ', '000761.SZ', '000762.SZ', '000766.SZ', '000768.SZ', '000776.SZ', '000777.SZ', '000778.SZ', '000783.SZ', '000786.SZ', '000792.SZ', '000793.SZ', '000806.SZ', '000810.SZ', '000816.SZ', '000825.SZ', '000826.SZ', '000829.SZ', '000830.SZ', '000839.SZ', '000848.SZ', '000858.SZ', '000860.SZ', '000876.SZ', '000877.SZ', '000878.SZ', '000895.SZ', '000897.SZ', '000917.SZ', '000926.SZ', '000930.SZ', '000937.SZ', '000938.SZ', '000939.SZ', '000959.SZ', '000960.SZ', '000961.SZ', '000963.SZ', '000969.SZ', '000970.SZ', '000975.SZ', '000977.SZ', '000979.SZ', '000983.SZ', '000988.SZ', '000997.SZ', '000998.SZ', '000999.SZ', '001696.SZ', '001979.SZ', '002001.SZ', '002002.SZ', '002004.SZ', '002005.SZ', '002007.SZ', '002008.SZ', '002011.SZ', '002013.SZ', '002018.SZ', '002019.SZ', '002022.SZ', '002024.SZ', '002027.SZ', '002028.SZ', '002030.SZ', '002038.SZ', '002041.SZ', '002044.SZ', '002048.SZ', '002049.SZ', '002050.SZ', '002051.SZ', '002056.SZ', '002063.SZ', '002064.SZ', '002065.SZ', '002073.SZ', '002074.SZ', '002078.SZ', '002081.SZ', '002092.SZ', '002093.SZ', '002106.SZ', '002118.SZ', '002120.SZ', '002122.SZ', '002123.SZ', '002127.SZ', '002128.SZ', '002131.SZ', '002142.SZ', '002146.SZ', '002147.SZ', '002152.SZ', '002153.SZ', '002155.SZ', '002174.SZ', '002176.SZ', '002179.SZ', '002183.SZ', '002190.SZ', '002191.SZ', '002194.SZ', '002195.SZ', '002202.SZ', '002217.SZ', '002221.SZ', '002223.SZ', '002230.SZ', '002233.SZ', '002236.SZ', '002241.SZ', '002242.SZ', '002244.SZ', '002249.SZ', '002250.SZ', '002251.SZ', '002252.SZ', '002254.SZ', '002261.SZ', '002266.SZ', '002268.SZ', '002269.SZ', '002271.SZ', '002273.SZ', '002276.SZ', '002277.SZ', '002281.SZ', '002285.SZ', '002292.SZ', '002299.SZ', '002304.SZ', '002308.SZ', '002309.SZ', '002310.SZ', '002311.SZ', '002315.SZ', '002317.SZ', '002325.SZ', '002332.SZ', '002340.SZ', '002342.SZ', '002344.SZ', '002345.SZ', '002352.SZ', '002353.SZ', '002354.SZ', '002358.SZ', '002366.SZ', '002368.SZ', '002371.SZ', '002373.SZ', '002375.SZ', '002384.SZ', '002385.SZ', '002390.SZ', '002392.SZ', '002396.SZ', '002400.SZ', '002405.SZ', '002407.SZ', '002408.SZ', '002410.SZ', '002411.SZ', '002414.SZ', '002415.SZ', '002416.SZ', '002422.SZ', '002424.SZ', '002426.SZ', '002428.SZ', '002431.SZ', '002437.SZ', '002439.SZ', '002440.SZ', '002444.SZ', '002450.SZ', '002456.SZ', '002460.SZ', '002463.SZ', '002465.SZ', '002466.SZ', '002468.SZ', '002470.SZ', '002475.SZ', '002477.SZ', '002479.SZ', '002482.SZ', '002489.SZ', '002491.SZ', '002500.SZ', '002503.SZ', '002505.SZ', '002508.SZ', '002512.SZ', '002517.SZ', '002544.SZ', '002551.SZ', '002555.SZ', '002558.SZ', '002572.SZ', '002573.SZ', '002583.SZ', '002588.SZ', '002589.SZ', '002594.SZ', '002601.SZ', '002602.SZ', '002603.SZ', '002635.SZ', '002640.SZ', '002642.SZ', '002646.SZ', '002657.SZ', '002663.SZ', '002665.SZ', '002670.SZ', '002672.SZ', '002673.SZ', '002681.SZ', '002690.SZ', '002699.SZ', '002701.SZ', '002707.SZ', '002709.SZ', '002714.SZ', '002727.SZ', '002736.SZ', '002739.SZ', '002797.SZ', '002807.SZ', '002815.SZ', '002818.SZ', '002831.SZ', '002839.SZ', '002841.SZ', '300001.SZ', '300002.SZ', '300010.SZ', '300017.SZ', '300024.SZ', '300026.SZ', '300027.SZ', '300032.SZ', '300033.SZ', '300039.SZ', '300043.SZ', '300055.SZ', '300058.SZ', '300059.SZ', '300070.SZ', '300072.SZ', '300088.SZ', '300104.SZ', '300113.SZ', '300115.SZ', '300116.SZ', '300122.SZ', '300124.SZ', '300133.SZ', '300134.SZ', '300136.SZ', '300144.SZ', '300146.SZ', '300147.SZ', '300156.SZ', '300159.SZ', '300166.SZ', '300168.SZ', '300199.SZ', '300202.SZ', '300244.SZ', '300251.SZ', '300253.SZ', '300257.SZ', '300266.SZ', '300273.SZ', '300274.SZ', '300287.SZ', '300291.SZ', '300296.SZ', '300297.SZ', '300315.SZ', '300324.SZ', '300376.SZ', '300383.SZ', '600000.SH', '600006.SH', '600008.SH', '600009.SH', '600010.SH', '600015.SH', '600016.SH', '600017.SH', '600018.SH', '600019.SH', '600021.SH', '600022.SH', '600023.SH', '600026.SH', '600028.SH', '600029.SH', '600030.SH', '600031.SH', '600036.SH', '600037.SH', '600038.SH', '600039.SH', '600048.SH', '600050.SH', '600053.SH', '600056.SH', '600058.SH', '600059.SH', '600060.SH', '600061.SH', '600062.SH', '600064.SH', '600066.SH', '600068.SH', '600073.SH', '600074.SH', '600079.SH', '600085.SH', '600086.SH', '600089.SH', '600094.SH', '600098.SH', '600100.SH', '600104.SH', '600108.SH', '600109.SH', '600111.SH', '600115.SH', '600118.SH', '600120.SH', '600122.SH', '600125.SH', '600126.SH', '600138.SH', '600141.SH', '600143.SH', '600150.SH', '600151.SH', '600153.SH', '600157.SH', '600158.SH', '600160.SH', '600161.SH', '600166.SH', '600169.SH', '600170.SH', '600171.SH', '600176.SH', '600177.SH', '600183.SH', '600184.SH', '600187.SH', '600188.SH', '600195.SH', '600196.SH', '600198.SH', '600200.SH', '600201.SH', '600208.SH', '600216.SH', '600219.SH', '600220.SH', '600221.SH', '600233.SH', '600240.SH', '600251.SH', '600256.SH', '600259.SH', '600260.SH', '600266.SH', '600267.SH', '600270.SH', '600271.SH', '600276.SH', '600277.SH', '600280.SH', '600282.SH', '600284.SH', '600289.SH', '600291.SH', '600292.SH', '600297.SH', '600298.SH', '600300.SH', '600307.SH', '600309.SH', '600312.SH', '600315.SH', '600316.SH', '600325.SH', '600329.SH', '600332.SH', '600335.SH', '600338.SH', '600340.SH', '600348.SH', '600352.SH', '600362.SH', '600366.SH', '600369.SH', '600372.SH', '600373.SH', '600376.SH', '600380.SH', '600383.SH', '600388.SH', '600392.SH', '600395.SH', '600406.SH', '600409.SH', '600410.SH', '600415.SH', '600416.SH', '600418.SH', '600422.SH', '600426.SH', '600428.SH', '600435.SH', '600436.SH', '600446.SH', '600458.SH', '600460.SH', '600466.SH', '600478.SH', '600481.SH', '600482.SH', '600485.SH', '600487.SH', '600489.SH', '600496.SH', '600498.SH', '600499.SH', '600500.SH', '600503.SH', '600511.SH', '600516.SH', '600517.SH', '600518.SH', '600519.SH', '600521.SH', '600522.SH', '600525.SH', '600528.SH', '600535.SH', '600536.SH', '600537.SH', '600545.SH', '600547.SH', '600549.SH', '600551.SH', '600557.SH', '600563.SH', '600565.SH', '600566.SH', '600570.SH', '600572.SH', '600580.SH', '600582.SH', '600583.SH', '600584.SH', '600585.SH', '600586.SH', '600587.SH', '600588.SH', '600594.SH', '600596.SH', '600597.SH', '600600.SH', '600606.SH', '600611.SH', '600614.SH', '600618.SH', '600628.SH', '600633.SH', '600635.SH', '600637.SH', '600639.SH', '600640.SH', '600642.SH', '600643.SH', '600645.SH', '600648.SH', '600649.SH', '600651.SH', '600655.SH', '600657.SH', '600660.SH', '600663.SH', '600664.SH', '600673.SH', '600674.SH', '600682.SH', '600685.SH', '600687.SH', '600688.SH', '600690.SH', '600694.SH', '600699.SH', '600703.SH', '600704.SH', '600705.SH', '600717.SH', '600718.SH', '600720.SH', '600729.SH', '600736.SH', '600737.SH', '600739.SH', '600741.SH', '600743.SH', '600748.SH', '600750.SH', '600751.SH', '600754.SH', '600755.SH', '600757.SH', '600759.SH', '600765.SH', '600770.SH', '600773.SH', '600776.SH', '600787.SH', '600790.SH', '600795.SH', '600801.SH', '600804.SH', '600805.SH', '600808.SH', '600809.SH', '600811.SH', '600816.SH', '600820.SH', '600826.SH', '600827.SH', '600831.SH', '600835.SH', '600837.SH', '600839.SH', '600848.SH', '600859.SH', '600862.SH', '600863.SH', '600869.SH', '600871.SH', '600872.SH', '600874.SH', '600879.SH', '600880.SH', '600881.SH', '600884.SH', '600886.SH', '600887.SH', '600893.SH', '600894.SH', '600895.SH', '600900.SH', '600909.SH', '600917.SH', '600919.SH', '600926.SH', '600936.SH', '600958.SH', '600959.SH', '600967.SH', '600970.SH', '600971.SH', '600977.SH', '600978.SH', '600993.SH', '600996.SH', '600999.SH', '601000.SH', '601001.SH', '601002.SH', '601006.SH', '601009.SH', '601012.SH', '601016.SH', '601018.SH', '601020.SH', '601021.SH', '601088.SH', '601099.SH', '601111.SH', '601117.SH', '601118.SH', '601127.SH', '601155.SH', '601163.SH', '601166.SH', '601168.SH', '601169.SH', '601186.SH', '601198.SH', '601211.SH', '601216.SH', '601225.SH', '601229.SH', '601231.SH', '601233.SH', '601288.SH', '601311.SH', '601318.SH', '601328.SH', '601333.SH', '601336.SH', '601375.SH', '601377.SH', '601390.SH', '601398.SH', '601555.SH', '601600.SH', '601601.SH', '601607.SH', '601608.SH', '601611.SH', '601618.SH', '601628.SH', '601633.SH', '601668.SH', '601669.SH', '601678.SH', '601688.SH', '601689.SH', '601699.SH', '601717.SH', '601718.SH', '601727.SH', '601766.SH', '601777.SH', '601788.SH', '601800.SH', '601811.SH', '601818.SH', '601857.SH', '601866.SH', '601872.SH', '601877.SH', '601880.SH', '601881.SH', '601886.SH', '601888.SH', '601899.SH', '601901.SH', '601919.SH', '601928.SH', '601929.SH', '601933.SH', '601939.SH', '601958.SH', '601966.SH', '601985.SH', '601988.SH', '601989.SH', '601992.SH', '601997.SH', '601998.SH', '603000.SH', '603001.SH', '603005.SH', '603019.SH', '603025.SH', '603077.SH', '603160.SH', '603169.SH', '603188.SH', '603198.SH', '603228.SH', '603328.SH', '603355.SH', '603369.SH', '603377.SH', '603444.SH', '603515.SH', '603528.SH', '603556.SH', '603567.SH', '603568.SH', '603569.SH', '603589.SH', '603658.SH', '603698.SH', '603766.SH', '603799.SH', '603806.SH', '603816.SH', '603858.SH', '603866.SH', '603868.SH', '603877.SH', '603883.SH', '603888.SH', '603993.SH']
    tradecalanderafter = ['20050104', '20050105', '20050106', '20050107', '20050110', '20050111', '20050112', '20050113', '20050114', '20050117', '20050118', '20050119', '20050120', '20050121', '20050124', '20050125', '20050126', '20050127', '20050128', '20050131', '20050201', '20050202', '20050203', '20050204', '20050216', '20050217', '20050218', '20050221', '20050222', '20050223', '20050224', '20050225', '20050228', '20050301', '20050302', '20050303', '20050304', '20050307', '20050308', '20050309', '20050310', '20050311', '20050314', '20050315', '20050316', '20050317', '20050318', '20050321', '20050322', '20050323', '20050324', '20050325', '20050328', '20050329', '20050330', '20050331', '20050401', '20050404', '20050405', '20050406', '20050407', '20050408', '20050411', '20050412', '20050413', '20050414', '20050415', '20050418', '20050419', '20050420', '20050421', '20050422', '20050425', '20050426', '20050427', '20050428', '20050429', '20050509', '20050510', '20050511', '20050512', '20050513', '20050516', '20050517', '20050518', '20050519', '20050520', '20050523', '20050524', '20050525', '20050526', '20050527', '20050530', '20050531', '20050601', '20050602', '20050603', '20050606', '20050607', '20050608', '20050609', '20050610', '20050613', '20050614', '20050615', '20050616', '20050617', '20050620', '20050621', '20050622', '20050623', '20050624', '20050627', '20050628', '20050629', '20050630', '20050701', '20050704', '20050705', '20050706', '20050707', '20050708', '20050711', '20050712', '20050713', '20050714', '20050715', '20050718', '20050719', '20050720', '20050721', '20050722', '20050725', '20050726', '20050727', '20050728', '20050729', '20050801', '20050802', '20050803', '20050804', '20050805', '20050808', '20050809', '20050810', '20050811', '20050812', '20050815', '20050816', '20050817', '20050818', '20050819', '20050822', '20050823', '20050824', '20050825', '20050826', '20050829', '20050830', '20050831', '20050901', '20050902', '20050905', '20050906', '20050907', '20050908', '20050909', '20050912', '20050913', '20050914', '20050915', '20050916', '20050919', '20050920', '20050921', '20050922', '20050923', '20050926', '20050927', '20050928', '20050929', '20050930', '20051010', '20051011', '20051012', '20051013', '20051014', '20051017', '20051018', '20051019', '20051020', '20051021', '20051024', '20051025', '20051026', '20051027', '20051028', '20051031', '20051101', '20051102', '20051103', '20051104', '20051107', '20051108', '20051109', '20051110', '20051111', '20051114', '20051115', '20051116', '20051117', '20051118', '20051121', '20051122', '20051123', '20051124', '20051125', '20051128', '20051129', '20051130', '20051201', '20051202', '20051205', '20051206', '20051207', '20051208', '20051209', '20051212', '20051213', '20051214', '20051215', '20051216', '20051219', '20051220', '20051221', '20051222', '20051223', '20051226', '20051227', '20051228', '20051229', '20051230', '20060104', '20060105', '20060106', '20060109', '20060110', '20060111', '20060112', '20060113', '20060116', '20060117', '20060118', '20060119', '20060120', '20060123', '20060124', '20060125', '20060206', '20060207', '20060208', '20060209', '20060210', '20060213', '20060214', '20060215', '20060216', '20060217', '20060220', '20060221', '20060222', '20060223', '20060224', '20060227', '20060228', '20060301', '20060302', '20060303', '20060306', '20060307', '20060308', '20060309', '20060310', '20060313', '20060314', '20060315', '20060316', '20060317', '20060320', '20060321', '20060322', '20060323', '20060324', '20060327', '20060328', '20060329', '20060330', '20060331', '20060403', '20060404', '20060405', '20060406', '20060407', '20060410', '20060411', '20060412', '20060413', '20060414', '20060417', '20060418', '20060419', '20060420', '20060421', '20060424', '20060425', '20060426', '20060427', '20060428', '20060508', '20060509', '20060510', '20060511', '20060512', '20060515', '20060516', '20060517', '20060518', '20060519', '20060522', '20060523', '20060524', '20060525', '20060526', '20060529', '20060530', '20060531', '20060601', '20060602', '20060605', '20060606', '20060607', '20060608', '20060609', '20060612', '20060613', '20060614', '20060615', '20060616', '20060619', '20060620', '20060621', '20060622', '20060623', '20060626', '20060627', '20060628', '20060629', '20060630', '20060703', '20060704', '20060705', '20060706', '20060707', '20060710', '20060711', '20060712', '20060713', '20060714', '20060717', '20060718', '20060719', '20060720', '20060721', '20060724', '20060725', '20060726', '20060727', '20060728', '20060731', '20060801', '20060802', '20060803', '20060804', '20060807', '20060808', '20060809', '20060810', '20060811', '20060814', '20060815', '20060816', '20060817', '20060818', '20060821', '20060822', '20060823', '20060824', '20060825', '20060828', '20060829', '20060830', '20060831', '20060901', '20060904', '20060905', '20060906', '20060907', '20060908', '20060911', '20060912', '20060913', '20060914', '20060915', '20060918', '20060919', '20060920', '20060921', '20060922', '20060925', '20060926', '20060927', '20060928', '20060929', '20061009', '20061010', '20061011', '20061012', '20061013', '20061016', '20061017', '20061018', '20061019', '20061020', '20061023', '20061024', '20061025', '20061026', '20061027', '20061030', '20061031', '20061101', '20061102', '20061103', '20061106', '20061107', '20061108', '20061109', '20061110', '20061113', '20061114', '20061115', '20061116', '20061117', '20061120', '20061121', '20061122', '20061123', '20061124', '20061127', '20061128', '20061129', '20061130', '20061201', '20061204', '20061205', '20061206', '20061207', '20061208', '20061211', '20061212', '20061213', '20061214', '20061215', '20061218', '20061219', '20061220', '20061221', '20061222', '20061225', '20061226', '20061227', '20061228', '20061229', '20070104', '20070105', '20070108', '20070109', '20070110', '20070111', '20070112', '20070115', '20070116', '20070117', '20070118', '20070119', '20070122', '20070123', '20070124', '20070125', '20070126', '20070129', '20070130', '20070131', '20070201', '20070202', '20070205', '20070206', '20070207', '20070208', '20070209', '20070212', '20070213', '20070214', '20070215', '20070216', '20070226', '20070227', '20070228', '20070301', '20070302', '20070305', '20070306', '20070307', '20070308', '20070309', '20070312', '20070313', '20070314', '20070315', '20070316', '20070319', '20070320', '20070321', '20070322', '20070323', '20070326', '20070327', '20070328', '20070329', '20070330', '20070402', '20070403', '20070404', '20070405', '20070406', '20070409', '20070410', '20070411', '20070412', '20070413', '20070416', '20070417', '20070418', '20070419', '20070420', '20070423', '20070424', '20070425', '20070426', '20070427', '20070430', '20070508', '20070509', '20070510', '20070511', '20070514', '20070515', '20070516', '20070517', '20070518', '20070521', '20070522', '20070523', '20070524', '20070525', '20070528', '20070529', '20070530', '20070531', '20070601', '20070604', '20070605', '20070606', '20070607', '20070608', '20070611', '20070612', '20070613', '20070614', '20070615', '20070618', '20070619', '20070620', '20070621', '20070622', '20070625', '20070626', '20070627', '20070628', '20070629', '20070702', '20070703', '20070704', '20070705', '20070706', '20070709', '20070710', '20070711', '20070712', '20070713', '20070716', '20070717', '20070718', '20070719', '20070720', '20070723', '20070724', '20070725', '20070726', '20070727', '20070730', '20070731', '20070801', '20070802', '20070803', '20070806', '20070807', '20070808', '20070809', '20070810', '20070813', '20070814', '20070815', '20070816', '20070817', '20070820', '20070821', '20070822', '20070823', '20070824', '20070827', '20070828', '20070829', '20070830', '20070831', '20070903', '20070904', '20070905', '20070906', '20070907', '20070910', '20070911', '20070912', '20070913', '20070914', '20070917', '20070918', '20070919', '20070920', '20070921', '20070924', '20070925', '20070926', '20070927', '20070928', '20071008', '20071009', '20071010', '20071011', '20071012', '20071015', '20071016', '20071017', '20071018', '20071019', '20071022', '20071023', '20071024', '20071025', '20071026', '20071029', '20071030', '20071031', '20071101', '20071102', '20071105', '20071106', '20071107', '20071108', '20071109', '20071112', '20071113', '20071114', '20071115', '20071116', '20071119', '20071120', '20071121', '20071122', '20071123', '20071126', '20071127', '20071128', '20071129', '20071130', '20071203', '20071204', '20071205', '20071206', '20071207', '20071210', '20071211', '20071212', '20071213', '20071214', '20071217', '20071218', '20071219', '20071220', '20071221', '20071224', '20071225', '20071226', '20071227', '20071228', '20080102', '20080103', '20080104', '20080107', '20080108', '20080109', '20080110', '20080111', '20080114', '20080115', '20080116', '20080117', '20080118', '20080121', '20080122', '20080123', '20080124', '20080125', '20080128', '20080129', '20080130', '20080131', '20080201', '20080204', '20080205', '20080213', '20080214', '20080215', '20080218', '20080219', '20080220', '20080221', '20080222', '20080225', '20080226', '20080227', '20080228', '20080229', '20080303', '20080304', '20080305', '20080306', '20080307', '20080310', '20080311', '20080312', '20080313', '20080314', '20080317', '20080318', '20080319', '20080320', '20080321', '20080324', '20080325', '20080326', '20080327', '20080328', '20080331', '20080401', '20080402', '20080403', '20080407', '20080408', '20080409', '20080410', '20080411', '20080414', '20080415', '20080416', '20080417', '20080418', '20080421', '20080422', '20080423', '20080424', '20080425', '20080428', '20080429', '20080430', '20080505', '20080506', '20080507', '20080508', '20080509', '20080512', '20080513', '20080514', '20080515', '20080516', '20080519', '20080520', '20080521', '20080522', '20080523', '20080526', '20080527', '20080528', '20080529', '20080530', '20080602', '20080603', '20080604', '20080605', '20080606', '20080610', '20080611', '20080612', '20080613', '20080616', '20080617', '20080618', '20080619', '20080620', '20080623', '20080624', '20080625', '20080626', '20080627', '20080630', '20080701', '20080702', '20080703', '20080704', '20080707', '20080708', '20080709', '20080710', '20080711', '20080714', '20080715', '20080716', '20080717', '20080718', '20080721', '20080722', '20080723', '20080724', '20080725', '20080728', '20080729', '20080730', '20080731', '20080801', '20080804', '20080805', '20080806', '20080807', '20080808', '20080811', '20080812', '20080813', '20080814', '20080815', '20080818', '20080819', '20080820', '20080821', '20080822', '20080825', '20080826', '20080827', '20080828', '20080829', '20080901', '20080902', '20080903', '20080904', '20080905', '20080908', '20080909', '20080910', '20080911', '20080912', '20080916', '20080917', '20080918', '20080919', '20080922', '20080923', '20080924', '20080925', '20080926', '20081006', '20081007', '20081008', '20081009', '20081010', '20081013', '20081014', '20081015', '20081016', '20081017', '20081020', '20081021', '20081022', '20081023', '20081024', '20081027', '20081028', '20081029', '20081030', '20081031', '20081103', '20081104', '20081105', '20081106', '20081107', '20081110', '20081111', '20081112', '20081113', '20081114', '20081117', '20081118', '20081119', '20081120', '20081121', '20081124', '20081125', '20081126', '20081127', '20081128', '20081201', '20081202', '20081203', '20081204', '20081205', '20081208', '20081209', '20081210', '20081211', '20081212', '20081215', '20081216', '20081217', '20081218', '20081219', '20081222', '20081223', '20081224', '20081225', '20081226', '20081229', '20081230', '20081231', '20090105', '20090106', '20090107', '20090108', '20090109', '20090112', '20090113', '20090114', '20090115', '20090116', '20090119', '20090120', '20090121', '20090122', '20090123', '20090202', '20090203', '20090204', '20090205', '20090206', '20090209', '20090210', '20090211', '20090212', '20090213', '20090216', '20090217', '20090218', '20090219', '20090220', '20090223', '20090224', '20090225', '20090226', '20090227', '20090302', '20090303', '20090304', '20090305', '20090306', '20090309', '20090310', '20090311', '20090312', '20090313', '20090316', '20090317', '20090318', '20090319', '20090320', '20090323', '20090324', '20090325', '20090326', '20090327', '20090330', '20090331', '20090401', '20090402', '20090403', '20090407', '20090408', '20090409', '20090410', '20090413', '20090414', '20090415', '20090416', '20090417', '20090420', '20090421', '20090422', '20090423', '20090424', '20090427', '20090428', '20090429', '20090430', '20090504', '20090505', '20090506', '20090507', '20090508', '20090511', '20090512', '20090513', '20090514', '20090515', '20090518', '20090519', '20090520', '20090521', '20090522', '20090525', '20090526', '20090527', '20090601', '20090602', '20090603', '20090604', '20090605', '20090608', '20090609', '20090610', '20090611', '20090612', '20090615', '20090616', '20090617', '20090618', '20090619', '20090622', '20090623', '20090624', '20090625', '20090626', '20090629', '20090630', '20090701', '20090702', '20090703', '20090706', '20090707', '20090708', '20090709', '20090710', '20090713', '20090714', '20090715', '20090716', '20090717', '20090720', '20090721', '20090722', '20090723', '20090724', '20090727', '20090728', '20090729', '20090730', '20090731', '20090803', '20090804', '20090805', '20090806', '20090807', '20090810', '20090811', '20090812', '20090813', '20090814', '20090817', '20090818', '20090819', '20090820', '20090821', '20090824', '20090825', '20090826', '20090827', '20090828', '20090831', '20090901', '20090902', '20090903', '20090904', '20090907', '20090908', '20090909', '20090910', '20090911', '20090914', '20090915', '20090916', '20090917', '20090918', '20090921', '20090922', '20090923', '20090924', '20090925', '20090928', '20090929', '20090930', '20091009', '20091012', '20091013', '20091014', '20091015', '20091016', '20091019', '20091020', '20091021', '20091022', '20091023', '20091026', '20091027', '20091028', '20091029', '20091030', '20091102', '20091103', '20091104', '20091105', '20091106', '20091109', '20091110', '20091111', '20091112', '20091113', '20091116', '20091117', '20091118', '20091119', '20091120', '20091123', '20091124', '20091125', '20091126', '20091127', '20091130', '20091201', '20091202', '20091203', '20091204', '20091207', '20091208', '20091209', '20091210', '20091211', '20091214', '20091215', '20091216', '20091217', '20091218', '20091221', '20091222', '20091223', '20091224', '20091225', '20091228', '20091229', '20091230', '20091231', '20100104', '20100105', '20100106', '20100107', '20100108', '20100111', '20100112', '20100113', '20100114', '20100115', '20100118', '20100119', '20100120', '20100121', '20100122', '20100125', '20100126', '20100127', '20100128', '20100129', '20100201', '20100202', '20100203', '20100204', '20100205', '20100208', '20100209', '20100210', '20100211', '20100212', '20100222', '20100223', '20100224', '20100225', '20100226', '20100301', '20100302', '20100303', '20100304', '20100305', '20100308', '20100309', '20100310', '20100311', '20100312', '20100315', '20100316', '20100317', '20100318', '20100319', '20100322', '20100323', '20100324', '20100325', '20100326', '20100329', '20100330', '20100331', '20100401', '20100402', '20100406', '20100407', '20100408', '20100409', '20100412', '20100413', '20100414', '20100415', '20100416', '20100419', '20100420', '20100421', '20100422', '20100423', '20100426', '20100427', '20100428', '20100429', '20100430', '20100504', '20100505', '20100506', '20100507', '20100510', '20100511', '20100512', '20100513', '20100514', '20100517', '20100518', '20100519', '20100520', '20100521', '20100524', '20100525', '20100526', '20100527', '20100528', '20100531', '20100601', '20100602', '20100603', '20100604', '20100607', '20100608', '20100609', '20100610', '20100611', '20100617', '20100618', '20100621', '20100622', '20100623', '20100624', '20100625', '20100628', '20100629', '20100630', '20100701', '20100702', '20100705', '20100706', '20100707', '20100708', '20100709', '20100712', '20100713', '20100714', '20100715', '20100716', '20100719', '20100720', '20100721', '20100722', '20100723', '20100726', '20100727', '20100728', '20100729', '20100730', '20100802', '20100803', '20100804', '20100805', '20100806', '20100809', '20100810', '20100811', '20100812', '20100813', '20100816', '20100817', '20100818', '20100819', '20100820', '20100823', '20100824', '20100825', '20100826', '20100827', '20100830', '20100831', '20100901', '20100902', '20100903', '20100906', '20100907', '20100908', '20100909', '20100910', '20100913', '20100914', '20100915', '20100916', '20100917', '20100920', '20100921', '20100927', '20100928', '20100929', '20100930', '20101008', '20101011', '20101012', '20101013', '20101014', '20101015', '20101018', '20101019', '20101020', '20101021', '20101022', '20101025', '20101026', '20101027', '20101028', '20101029', '20101101', '20101102', '20101103', '20101104', '20101105', '20101108', '20101109', '20101110', '20101111', '20101112', '20101115', '20101116', '20101117', '20101118', '20101119', '20101122', '20101123', '20101124', '20101125', '20101126', '20101129', '20101130', '20101201', '20101202', '20101203', '20101206', '20101207', '20101208', '20101209', '20101210', '20101213', '20101214', '20101215', '20101216', '20101217', '20101220', '20101221', '20101222', '20101223', '20101224', '20101227', '20101228', '20101229', '20101230', '20101231', '20110104', '20110105', '20110106', '20110107', '20110110', '20110111', '20110112', '20110113', '20110114', '20110117', '20110118', '20110119', '20110120', '20110121', '20110124', '20110125', '20110126', '20110127', '20110128', '20110131', '20110201', '20110209', '20110210', '20110211', '20110214', '20110215', '20110216', '20110217', '20110218', '20110221', '20110222', '20110223', '20110224', '20110225', '20110228', '20110301', '20110302', '20110303', '20110304', '20110307', '20110308', '20110309', '20110310', '20110311', '20110314', '20110315', '20110316', '20110317', '20110318', '20110321', '20110322', '20110323', '20110324', '20110325', '20110328', '20110329', '20110330', '20110331', '20110401', '20110406', '20110407', '20110408', '20110411', '20110412', '20110413', '20110414', '20110415', '20110418', '20110419', '20110420', '20110421', '20110422', '20110425', '20110426', '20110427', '20110428', '20110429', '20110503', '20110504', '20110505', '20110506', '20110509', '20110510', '20110511', '20110512', '20110513', '20110516', '20110517', '20110518', '20110519', '20110520', '20110523', '20110524', '20110525', '20110526', '20110527', '20110530', '20110531', '20110601', '20110602', '20110603', '20110607', '20110608', '20110609', '20110610', '20110613', '20110614', '20110615', '20110616', '20110617', '20110620', '20110621', '20110622', '20110623', '20110624', '20110627', '20110628', '20110629', '20110630', '20110701', '20110704', '20110705', '20110706', '20110707', '20110708', '20110711', '20110712', '20110713', '20110714', '20110715', '20110718', '20110719', '20110720', '20110721', '20110722', '20110725', '20110726', '20110727', '20110728', '20110729', '20110801', '20110802', '20110803', '20110804', '20110805', '20110808', '20110809', '20110810', '20110811', '20110812', '20110815', '20110816', '20110817', '20110818', '20110819', '20110822', '20110823', '20110824', '20110825', '20110826', '20110829', '20110830', '20110831', '20110901', '20110902', '20110905', '20110906', '20110907', '20110908', '20110909', '20110913', '20110914', '20110915', '20110916', '20110919', '20110920', '20110921', '20110922', '20110923', '20110926', '20110927', '20110928', '20110929', '20110930', '20111010', '20111011', '20111012', '20111013', '20111014', '20111017', '20111018', '20111019', '20111020', '20111021', '20111024', '20111025', '20111026', '20111027', '20111028', '20111031', '20111101', '20111102', '20111103', '20111104', '20111107', '20111108', '20111109', '20111110', '20111111', '20111114', '20111115', '20111116', '20111117', '20111118', '20111121', '20111122', '20111123', '20111124', '20111125', '20111128', '20111129', '20111130', '20111201', '20111202', '20111205', '20111206', '20111207', '20111208', '20111209', '20111212', '20111213', '20111214', '20111215', '20111216', '20111219', '20111220', '20111221', '20111222', '20111223', '20111226', '20111227', '20111228', '20111229', '20111230', '20120104', '20120105', '20120106', '20120109', '20120110', '20120111', '20120112', '20120113', '20120116', '20120117', '20120118', '20120119', '20120120', '20120130', '20120131', '20120201', '20120202', '20120203', '20120206', '20120207', '20120208', '20120209', '20120210', '20120213', '20120214', '20120215', '20120216', '20120217', '20120220', '20120221', '20120222', '20120223', '20120224', '20120227', '20120228', '20120229', '20120301', '20120302', '20120305', '20120306', '20120307', '20120308', '20120309', '20120312', '20120313', '20120314', '20120315', '20120316', '20120319', '20120320', '20120321', '20120322', '20120323', '20120326', '20120327', '20120328', '20120329', '20120330', '20120405', '20120406', '20120409', '20120410', '20120411', '20120412', '20120413', '20120416', '20120417', '20120418', '20120419', '20120420', '20120423', '20120424', '20120425', '20120426', '20120427', '20120502', '20120503', '20120504', '20120507', '20120508', '20120509', '20120510', '20120511', '20120514', '20120515', '20120516', '20120517', '20120518', '20120521', '20120522', '20120523', '20120524', '20120525', '20120528', '20120529', '20120530', '20120531', '20120601', '20120604', '20120605', '20120606', '20120607', '20120608', '20120611', '20120612', '20120613', '20120614', '20120615', '20120618', '20120619', '20120620', '20120621', '20120625', '20120626', '20120627', '20120628', '20120629', '20120702', '20120703', '20120704', '20120705', '20120706', '20120709', '20120710', '20120711', '20120712', '20120713', '20120716', '20120717', '20120718', '20120719', '20120720', '20120723', '20120724', '20120725', '20120726', '20120727', '20120730', '20120731', '20120801', '20120802', '20120803', '20120806', '20120807', '20120808', '20120809', '20120810', '20120813', '20120814', '20120815', '20120816', '20120817', '20120820', '20120821', '20120822', '20120823', '20120824', '20120827', '20120828', '20120829', '20120830', '20120831', '20120903', '20120904', '20120905', '20120906', '20120907', '20120910', '20120911', '20120912', '20120913', '20120914', '20120917', '20120918', '20120919', '20120920', '20120921', '20120924', '20120925', '20120926', '20120927', '20120928', '20121008', '20121009', '20121010', '20121011', '20121012', '20121015', '20121016', '20121017', '20121018', '20121019', '20121022', '20121023', '20121024', '20121025', '20121026', '20121029', '20121030', '20121031', '20121101', '20121102', '20121105', '20121106', '20121107', '20121108', '20121109', '20121112', '20121113', '20121114', '20121115', '20121116', '20121119', '20121120', '20121121', '20121122', '20121123', '20121126', '20121127', '20121128', '20121129', '20121130', '20121203', '20121204', '20121205', '20121206', '20121207', '20121210', '20121211', '20121212', '20121213', '20121214', '20121217', '20121218', '20121219', '20121220', '20121221', '20121224', '20121225', '20121226', '20121227', '20121228', '20121231', '20130104', '20130107', '20130108', '20130109', '20130110', '20130111', '20130114', '20130115', '20130116', '20130117', '20130118', '20130121', '20130122', '20130123', '20130124', '20130125', '20130128', '20130129', '20130130', '20130131', '20130201', '20130204', '20130205', '20130206', '20130207', '20130208', '20130218', '20130219', '20130220', '20130221', '20130222', '20130225', '20130226', '20130227', '20130228', '20130301', '20130304', '20130305', '20130306', '20130307', '20130308', '20130311', '20130312', '20130313', '20130314', '20130315', '20130318', '20130319', '20130320', '20130321', '20130322', '20130325', '20130326', '20130327', '20130328', '20130329', '20130401', '20130402', '20130403', '20130408', '20130409', '20130410', '20130411', '20130412', '20130415', '20130416', '20130417', '20130418', '20130419', '20130422', '20130423', '20130424', '20130425', '20130426', '20130502', '20130503', '20130506', '20130507', '20130508', '20130509', '20130510', '20130513', '20130514', '20130515', '20130516', '20130517', '20130520', '20130521', '20130522', '20130523', '20130524', '20130527', '20130528', '20130529', '20130530', '20130531', '20130603', '20130604', '20130605', '20130606', '20130607', '20130613', '20130614', '20130617', '20130618', '20130619', '20130620', '20130621', '20130624', '20130625', '20130626', '20130627', '20130628', '20130701', '20130702', '20130703', '20130704', '20130705', '20130708', '20130709', '20130710', '20130711', '20130712', '20130715', '20130716', '20130717', '20130718', '20130719', '20130722', '20130723', '20130724', '20130725', '20130726', '20130729', '20130730', '20130731', '20130801', '20130802', '20130805', '20130806', '20130807', '20130808', '20130809', '20130812', '20130813', '20130814', '20130815', '20130816', '20130819', '20130820', '20130821', '20130822', '20130823', '20130826', '20130827', '20130828', '20130829', '20130830', '20130902', '20130903', '20130904', '20130905', '20130906', '20130909', '20130910', '20130911', '20130912', '20130913', '20130916', '20130917', '20130918', '20130923', '20130924', '20130925', '20130926', '20130927', '20130930', '20131008', '20131009', '20131010', '20131011', '20131014', '20131015', '20131016', '20131017', '20131018', '20131021', '20131022', '20131023', '20131024', '20131025', '20131028', '20131029', '20131030', '20131031', '20131101', '20131104', '20131105', '20131106', '20131107', '20131108', '20131111', '20131112', '20131113', '20131114', '20131115', '20131118', '20131119', '20131120', '20131121', '20131122', '20131125', '20131126', '20131127', '20131128', '20131129', '20131202', '20131203', '20131204', '20131205', '20131206', '20131209', '20131210', '20131211', '20131212', '20131213', '20131216', '20131217', '20131218', '20131219', '20131220', '20131223', '20131224', '20131225', '20131226', '20131227', '20131230', '20131231', '20140102', '20140103', '20140106', '20140107', '20140108', '20140109', '20140110', '20140113', '20140114', '20140115', '20140116', '20140117', '20140120', '20140121', '20140122', '20140123', '20140124', '20140127', '20140128', '20140129', '20140130', '20140207', '20140210', '20140211', '20140212', '20140213', '20140214', '20140217', '20140218', '20140219', '20140220', '20140221', '20140224', '20140225', '20140226', '20140227', '20140228', '20140303', '20140304', '20140305', '20140306', '20140307', '20140310', '20140311', '20140312', '20140313', '20140314', '20140317', '20140318', '20140319', '20140320', '20140321', '20140324', '20140325', '20140326', '20140327', '20140328', '20140331', '20140401', '20140402', '20140403', '20140404', '20140408', '20140409', '20140410', '20140411', '20140414', '20140415', '20140416', '20140417', '20140418', '20140421', '20140422', '20140423', '20140424', '20140425', '20140428', '20140429', '20140430', '20140505', '20140506', '20140507', '20140508', '20140509', '20140512', '20140513', '20140514', '20140515', '20140516', '20140519', '20140520', '20140521', '20140522', '20140523', '20140526', '20140527', '20140528', '20140529', '20140530', '20140603', '20140604', '20140605', '20140606', '20140609', '20140610', '20140611', '20140612', '20140613', '20140616', '20140617', '20140618', '20140619', '20140620', '20140623', '20140624', '20140625', '20140626', '20140627', '20140630', '20140701', '20140702', '20140703', '20140704', '20140707', '20140708', '20140709', '20140710', '20140711', '20140714', '20140715', '20140716', '20140717', '20140718', '20140721', '20140722', '20140723', '20140724', '20140725', '20140728', '20140729', '20140730', '20140731', '20140801', '20140804', '20140805', '20140806', '20140807', '20140808', '20140811', '20140812', '20140813', '20140814', '20140815', '20140818', '20140819', '20140820', '20140821', '20140822', '20140825', '20140826', '20140827', '20140828', '20140829', '20140901', '20140902', '20140903', '20140904', '20140905', '20140909', '20140910', '20140911', '20140912', '20140915', '20140916', '20140917', '20140918', '20140919', '20140922', '20140923', '20140924', '20140925', '20140926', '20140929', '20140930', '20141008', '20141009', '20141010', '20141013', '20141014', '20141015', '20141016', '20141017', '20141020', '20141021', '20141022', '20141023', '20141024', '20141027', '20141028', '20141029', '20141030', '20141031', '20141103', '20141104', '20141105', '20141106', '20141107', '20141110', '20141111', '20141112', '20141113', '20141114', '20141117', '20141118', '20141119', '20141120', '20141121', '20141124', '20141125', '20141126', '20141127', '20141128', '20141201', '20141202', '20141203', '20141204', '20141205', '20141208', '20141209', '20141210', '20141211', '20141212', '20141215', '20141216', '20141217', '20141218', '20141219', '20141222', '20141223', '20141224', '20141225', '20141226', '20141229', '20141230', '20141231', '20150105', '20150106', '20150107', '20150108', '20150109', '20150112', '20150113', '20150114', '20150115', '20150116', '20150119', '20150120', '20150121', '20150122', '20150123', '20150126', '20150127', '20150128', '20150129', '20150130', '20150202', '20150203', '20150204', '20150205', '20150206', '20150209', '20150210', '20150211', '20150212', '20150213', '20150216', '20150217', '20150225', '20150226', '20150227', '20150302', '20150303', '20150304', '20150305', '20150306', '20150309', '20150310', '20150311', '20150312', '20150313', '20150316', '20150317', '20150318', '20150319', '20150320', '20150323', '20150324', '20150325', '20150326', '20150327', '20150330', '20150331', '20150401', '20150402', '20150403', '20150407', '20150408', '20150409', '20150410', '20150413', '20150414', '20150415', '20150416', '20150417', '20150420', '20150421', '20150422', '20150423', '20150424', '20150427', '20150428', '20150429', '20150430', '20150504', '20150505', '20150506', '20150507', '20150508', '20150511', '20150512', '20150513', '20150514', '20150515', '20150518', '20150519', '20150520', '20150521', '20150522', '20150525', '20150526', '20150527', '20150528', '20150529', '20150601', '20150602', '20150603', '20150604', '20150605', '20150608', '20150609', '20150610', '20150611', '20150612', '20150615', '20150616', '20150617', '20150618', '20150619', '20150623', '20150624', '20150625', '20150626', '20150629', '20150630', '20150701', '20150702', '20150703', '20150706', '20150707', '20150708', '20150709', '20150710', '20150713', '20150714', '20150715', '20150716', '20150717', '20150720', '20150721', '20150722', '20150723', '20150724', '20150727', '20150728', '20150729', '20150730', '20150731', '20150803', '20150804', '20150805', '20150806', '20150807', '20150810', '20150811', '20150812', '20150813', '20150814', '20150817', '20150818', '20150819', '20150820', '20150821', '20150824', '20150825', '20150826', '20150827', '20150828', '20150831', '20150901', '20150902', '20150907', '20150908', '20150909', '20150910', '20150911', '20150914', '20150915', '20150916', '20150917', '20150918', '20150921', '20150922', '20150923', '20150924', '20150925', '20150928', '20150929', '20150930', '20151008', '20151009', '20151012', '20151013', '20151014', '20151015', '20151016', '20151019', '20151020', '20151021', '20151022', '20151023', '20151026', '20151027', '20151028', '20151029', '20151030', '20151102', '20151103', '20151104', '20151105', '20151106', '20151109', '20151110', '20151111', '20151112', '20151113', '20151116', '20151117', '20151118', '20151119', '20151120', '20151123', '20151124', '20151125', '20151126', '20151127', '20151130', '20151201', '20151202', '20151203', '20151204', '20151207', '20151208', '20151209', '20151210', '20151211', '20151214', '20151215', '20151216', '20151217', '20151218', '20151221', '20151222', '20151223', '20151224', '20151225', '20151228', '20151229', '20151230', '20151231', '20160104', '20160105', '20160106', '20160107', '20160108', '20160111', '20160112', '20160113', '20160114', '20160115', '20160118', '20160119', '20160120', '20160121', '20160122', '20160125', '20160126', '20160127', '20160128', '20160129', '20160201', '20160202', '20160203', '20160204', '20160205', '20160215', '20160216', '20160217', '20160218', '20160219', '20160222', '20160223', '20160224', '20160225', '20160226', '20160229', '20160301', '20160302', '20160303', '20160304', '20160307', '20160308', '20160309', '20160310', '20160311', '20160314', '20160315', '20160316', '20160317', '20160318', '20160321', '20160322', '20160323', '20160324', '20160325', '20160328', '20160329', '20160330', '20160331', '20160401', '20160405', '20160406', '20160407', '20160408', '20160411', '20160412', '20160413', '20160414', '20160415', '20160418', '20160419', '20160420', '20160421', '20160422', '20160425', '20160426', '20160427', '20160428', '20160429', '20160503', '20160504', '20160505', '20160506', '20160509', '20160510', '20160511', '20160512', '20160513', '20160516', '20160517', '20160518', '20160519', '20160520', '20160523', '20160524', '20160525', '20160526', '20160527', '20160530', '20160531', '20160601', '20160602', '20160603', '20160606', '20160607', '20160608', '20160613', '20160614', '20160615', '20160616', '20160617', '20160620', '20160621', '20160622', '20160623', '20160624', '20160627', '20160628', '20160629', '20160630', '20160701', '20160704', '20160705', '20160706', '20160707', '20160708', '20160711', '20160712', '20160713', '20160714', '20160715', '20160718', '20160719', '20160720', '20160721', '20160722', '20160725', '20160726', '20160727', '20160728', '20160729', '20160801', '20160802', '20160803', '20160804', '20160805', '20160808', '20160809', '20160810', '20160811', '20160812', '20160815', '20160816', '20160817', '20160818', '20160819', '20160822', '20160823', '20160824', '20160825', '20160826', '20160829', '20160830', '20160831', '20160901', '20160902', '20160905', '20160906', '20160907', '20160908', '20160909', '20160912', '20160913', '20160914', '20160919', '20160920', '20160921', '20160922', '20160923', '20160926', '20160927', '20160928', '20160929', '20160930', '20161010', '20161011', '20161012', '20161013', '20161014', '20161017', '20161018', '20161019', '20161020', '20161021', '20161024', '20161025', '20161026', '20161027', '20161028', '20161031', '20161101', '20161102', '20161103', '20161104', '20161107', '20161108', '20161109', '20161110', '20161111', '20161114', '20161115', '20161116', '20161117', '20161118', '20161121', '20161122', '20161123', '20161124', '20161125', '20161128', '20161129', '20161130', '20161201', '20161202', '20161205', '20161206', '20161207', '20161208', '20161209', '20161212', '20161213', '20161214', '20161215', '20161216', '20161219', '20161220', '20161221', '20161222', '20161223', '20161226', '20161227', '20161228', '20161229', '20161230', '20170103', '20170104', '20170105', '20170106', '20170109', '20170110', '20170111', '20170112', '20170113', '20170116', '20170117', '20170118', '20170119', '20170120', '20170123', '20170124', '20170125', '20170126', '20170203', '20170206', '20170207', '20170208', '20170209', '20170210', '20170213', '20170214', '20170215', '20170216', '20170217', '20170220', '20170221', '20170222', '20170223', '20170224', '20170227', '20170228', '20170301', '20170302', '20170303', '20170306', '20170307', '20170308', '20170309', '20170310', '20170313', '20170314', '20170315', '20170316', '20170317', '20170320', '20170321', '20170322', '20170323', '20170324', '20170327', '20170328', '20170329', '20170330', '20170331', '20170405', '20170406', '20170407', '20170410', '20170411', '20170412', '20170413', '20170414', '20170417', '20170418', '20170419', '20170420', '20170421', '20170424', '20170425', '20170426', '20170427', '20170428', '20170502', '20170503', '20170504', '20170505', '20170508', '20170509', '20170510', '20170511', '20170512', '20170515', '20170516', '20170517', '20170518', '20170519', '20170522', '20170523', '20170524', '20170525', '20170526', '20170531', '20170601', '20170602', '20170605', '20170606', '20170607', '20170608', '20170609', '20170612', '20170613', '20170614', '20170615', '20170616', '20170619', '20170620', '20170621', '20170622', '20170623', '20170626', '20170627', '20170628', '20170629', '20170630', '20170703', '20170704', '20170705', '20170706', '20170707', '20170710', '20170711', '20170712', '20170713', '20170714', '20170717', '20170718', '20170719', '20170720', '20170721', '20170724', '20170725', '20170726', '20170727', '20170728', '20170731', '20170801', '20170802', '20170803', '20170804', '20170807', '20170808', '20170809', '20170810', '20170811', '20170814', '20170815', '20170816', '20170817', '20170818', '20170821', '20170822', '20170823', '20170824', '20170825', '20170828', '20170829', '20170830', '20170831', '20170901', '20170904', '20170905', '20170906', '20170907', '20170908', '20170911', '20170912', '20170913', '20170914', '20170915', '20170918', '20170919', '20170920', '20170921', '20170922', '20170925', '20170926', '20170927', '20170928', '20170929', '20171009', '20171010', '20171011', '20171012', '20171013', '20171016', '20171017', '20171018', '20171019', '20171020', '20171023', '20171024', '20171025', '20171026', '20171027', '20171030', '20171031', '20171101', '20171102', '20171103', '20171106', '20171107', '20171108', '20171109', '20171110', '20171113', '20171114', '20171115', '20171116', '20171117', '20171120', '20171121', '20171122', '20171123', '20171124', '20171127', '20171128', '20171129', '20171130', '20171201', '20171204', '20171205', '20171206', '20171207', '20171208', '20171211', '20171212', '20171213', '20171214', '20171215', '20171218', '20171219', '20171220', '20171221', '20171222', '20171225', '20171226', '20171227', '20171228', '20171229', '20180102', '20180103', '20180104', '20180105', '20180108', '20180109', '20180110', '20180111', '20180112', '20180115', '20180116', '20180117', '20180118', '20180119', '20180122', '20180123', '20180124', '20180125', '20180126', '20180129', '20180130', '20180131', '20180201', '20180202', '20180205', '20180206', '20180207', '20180208', '20180209', '20180212', '20180213', '20180214', '20180222', '20180223', '20180226', '20180227', '20180228', '20180301', '20180302', '20180305', '20180306', '20180307', '20180308', '20180309', '20180312', '20180313', '20180314', '20180315', '20180316', '20180319', '20180320', '20180321', '20180322', '20180323', '20180326', '20180327', '20180328', '20180329', '20180330', '20180402', '20180403', '20180404', '20180409', '20180410', '20180411', '20180412', '20180413', '20180416', '20180417', '20180418', '20180419', '20180420', '20180423', '20180424', '20180425', '20180426', '20180427', '20180502', '20180503', '20180504', '20180507', '20180508', '20180509', '20180510', '20180511', '20180514', '20180515', '20180516', '20180517', '20180518', '20180521', '20180522', '20180523', '20180524', '20180525', '20180528', '20180529', '20180530', '20180531', '20180601', '20180604', '20180605', '20180606', '20180607', '20180608', '20180611', '20180612', '20180613', '20180614', '20180615', '20180619', '20180620', '20180621', '20180622', '20180625', '20180626', '20180627', '20180628', '20180629', '20180702', '20180703', '20180704', '20180705', '20180706', '20180709', '20180710', '20180711', '20180712', '20180713', '20180716', '20180717', '20180718', '20180719', '20180720', '20180723', '20180724', '20180725', '20180726', '20180727', '20180730', '20180731', '20180801', '20180802', '20180803', '20180806', '20180807', '20180808', '20180809', '20180810', '20180813', '20180814', '20180815', '20180816', '20180817', '20180820', '20180821', '20180822', '20180823', '20180824', '20180827', '20180828', '20180829', '20180830', '20180831', '20180903', '20180904', '20180905', '20180906', '20180907', '20180910', '20180911', '20180912', '20180913', '20180914', '20180917', '20180918', '20180919', '20180920', '20180921', '20180925', '20180926', '20180927', '20180928', '20181008', '20181009', '20181010', '20181011', '20181012']
    tradecalander3year = tradecalanderafter[2612:]
    MktValue = pd.read_pickle('E:/datatushare/stockA20181012dailybasic/stockdailybasiczz800panel20151012_20181012.pkl').minor_xs('total_mv')
    pct_change = pd.read_pickle('E:/datatushare/stockA20181012qfq/stockzz800panel20151012_20181012.pkl').minor_xs('pct_change')/100.0

    # 2.回归取残差,X取市值和28个行业
    sw_industry_matrix_zz800 = pd.read_pickle('E:\\datatushare\\stockA20181012qfq\\sw_industry_matrix_zz800.pkl')
    industrystylealphacolumns = sw_industry_matrix_zz800.columns.tolist() + ['Size', 'Alpha']
    industrystylecolumns = sw_industry_matrix_zz800.columns.tolist() + ['Size']
    industrystylepcgcolumns = sw_industry_matrix_zz800.columns.tolist() + ['Size'] + ['pcgshift']
    shiftday = 10
    return alphaall, stock_zz800_list, tradecalanderafter, tradecalander3year, MktValue, pct_change, sw_industry_matrix_zz800, industrystylealphacolumns, industrystylecolumns, industrystylepcgcolumns, shiftday
alpha001,alpha002,alpha003,alpha004,alpha005,alpha006,alpha007,alpha008,alpha009,alpha010,alpha011,alpha012,alpha013,alpha014,alpha015,alpha016,alpha017,alpha018,alpha019,alpha020,alpha021,alpha022,alpha023,alpha024,alpha025,alpha026,alpha027,alpha029,alpha031,alpha032 = getalpha()
alphaall, stock_zz800_list, tradecalanderafter, tradecalander3year, MktValue, pct_change, sw_industry_matrix_zz800, industrystylealphacolumns, industrystylecolumns, industrystylepcgcolumns, shiftday = getinputdata()

# 2.回归取残差,X取市值和28个行业。获取风险中性化之后的回归残差，这里与alpha因子没有关系
def winsorized(x):  # x可为一个Series，也可以为一个array
    #    print x
    x[x > x.mean() + 3 * x.std()] = x.mean() + 3 * x.std()
    x[x < x.mean() - 3 * x.std()] = x.mean() - 3 * x.std()
    return x
def standardized(x):
    x = (x - x.mean()) / x.std()
    return x
def standardizedzscore(df):  # 使用zscore的方法进行标准化
    a = pd.DataFrame(index=tradecalander3year, columns=stock_zz800_list).T
    for i in tradecalander3year:
        #    i = '20181012'
        a[i] = pd.DataFrame(standardized(winsorized(df.loc[i])))
    return a.T
MktValueStandardized = standardizedzscore(MktValue)
def getresidual(): #获得每个因子的残差
    # step1:开始做截面回归,取残差截面
    b = pd.DataFrame(index=tradecalander3year, columns=stock_zz800_list).T
    for date in tradecalander3year:
        #    industrystyle =
        #    date = '20181010'
        industrystyle = pd.concat([sw_industry_matrix_zz800, MktValueStandardized.loc[date], pct_change.loc[date]], axis=1)
        industrystyle.columns = industrystylepcgcolumns

        a = industrystyle.dropna()
        if len(a) > 39:  # 大于38个样本才进行回归
            X = np.array(a[industrystylecolumns]).tolist()
            Y = np.array(a['pcgshift'])
            results = sm.OLS(Y, X).fit()
            residual = Y - results.predict(X)
            b[date] = pd.DataFrame(residual, index=a.index, columns=[date])
    pct_change_residual = b.T
    return pct_change_residual #
pct_change_residual = getresidual()

# 3.获取样本，每2个星期更新一次模型，每次训练时，采用最近4年的数据（先还是只考虑半年吧）。特征包括，28个行业，市值因子，30个alpha因子
def getclassifiedstock(flag = 'pct_change_residual'):
    if flag == 'pct_change_residual':
        a = pct_change_residual.rolling(window=shiftday, min_periods=shiftday).apply(lambda x: ((1+x).cumprod()-1)[-1]).shift(-shiftday)
    elif flag == 'pct_change':
        a = pct_change.rolling(window=shiftday, min_periods=shiftday).apply(lambda x: ((1+x).cumprod()-1)[-1]).shift(-shiftday)
    a[a == 0] = np.nan #把0去掉，因为有可能是停牌的
    b=a.rank(axis=1, ascending=False) # 业绩越好的股票，排名数字越小。即涨的最多的就是第一名
    positive = {}  #涨
    negative = {}  #跌
    flat = {}   #平
    for date in tradecalander3year:
        e = b.loc[date].dropna().sort_values()
        positive[date] = e[:80].index.tolist() #每天取前80名作为涨
        negative[date] = e[-80:].index.tolist()
        flat[date] = e[int(len(e)/2)-40: int(len(e)/2)+40].index.tolist()  #中间的80名最为平
    return positive,negative,flat
positive,negative,flat = getclassifiedstock()  #默认使用pct_change_residual，残差，即广发证券里面的内容
# positive,negative,flat = getclassifiedstock('pct_change')  #直接使用未来10天的收益率的排序作为Y
featurecolumns = sw_industry_matrix_zz800.columns.tolist() + ['Size'] + alphaall[:20]
def getsampleall(positive,flag = 'notall'):
    positivesampleall = {}
    for date in tradecalander3year:#这里可以一次性全部搞下来，然后再搞x和y！！！！！！！！！！！！！！！！！！！！！！！！！！
        # date = '20180907'
        if flag != 'all':
            a = pd.concat([sw_industry_matrix_zz800.loc[positive[date]], MktValueStandardized.loc[date][positive[date]], alpha001[0].loc[date][positive[date]], alpha002[0].loc[date][positive[date]], alpha003[0].loc[date][positive[date]], alpha004[0].loc[date][positive[date]], alpha005[0].loc[date][positive[date]], alpha006[0].loc[date][positive[date]], alpha007[0].loc[date][positive[date]], alpha008[0].loc[date][positive[date]], alpha009[0].loc[date][positive[date]], alpha010[0].loc[date][positive[date]], alpha011[0].loc[date][positive[date]], alpha012[0].loc[date][positive[date]], alpha013[0].loc[date][positive[date]], alpha014[0].loc[date][positive[date]], alpha015[0].loc[date][positive[date]], alpha016[0].loc[date][positive[date]], alpha017[0].loc[date][positive[date]], alpha018[0].loc[date][positive[date]], alpha019[0].loc[date][positive[date]], alpha020[0].loc[date][positive[date]]],axis = 1)
        else:
            a = pd.concat([sw_industry_matrix_zz800.loc[positive], MktValueStandardized.loc[date][positive], alpha001[0].loc[date][positive], alpha002[0].loc[date][positive], alpha003[0].loc[date][positive], alpha004[0].loc[date][positive], alpha005[0].loc[date][positive], alpha006[0].loc[date][positive], alpha007[0].loc[date][positive], alpha008[0].loc[date][positive], alpha009[0].loc[date][positive], alpha010[0].loc[date][positive], alpha011[0].loc[date][positive], alpha012[0].loc[date][positive], alpha013[0].loc[date][positive], alpha014[0].loc[date][positive], alpha015[0].loc[date][positive], alpha016[0].loc[date][positive], alpha017[0].loc[date][positive], alpha018[0].loc[date][positive], alpha019[0].loc[date][positive], alpha020[0].loc[date][positive]],axis = 1)

        a.columns = featurecolumns
        b = a.fillna(a.mean())#     还是要np.nan补起来，否则太多的样本直接没有用了,如果有一列全部为NAN，那就没有救了，整体舍弃
        if flag != 'all':
            if len(b) != 0:
                positivesampleall[date] = np.array(b.dropna())
            else:
                positivesampleall[date] = np.empty(shape=[0, len(featurecolumns)])
        else:
            positivesampleall[date] = b.dropna()  #需要用于回测，需要对应股票，故这里不能不用dataframe
    return positivesampleall
positivesampleall = getsampleall(positive);negativesampleall = getsampleall(negative);flatsampleall = getsampleall(flat)
zz800sampleall = getsampleall(stock_zz800_list, 'all')
del alpha001,alpha002,alpha003,alpha004,alpha005,alpha006,alpha007,alpha008,alpha009,alpha010,alpha011,alpha012,alpha013,alpha014,alpha015,alpha016,alpha017,alpha018,alpha019,alpha020,alpha021,alpha022,alpha023,alpha024,alpha025,alpha026,alpha027,alpha029,alpha031,alpha032; gc.collect()
def getsample(positivesampleall, traindate):
    positivesample = np.empty(shape=[0, len(featurecolumns)])
    for date in traindate:
        # positivesample = np.concatenate((positivesample, np.array(positivesampleall[date].dropna())))
        positivesample = np.append(positivesample, np.array(positivesampleall[date]),axis=0)
    return positivesample

# 4.深度学习模型训练部分，滚动训练，滚动预测。分为两个部分，第一部分是获取模型，第二部分是获取top分组
def getmodel():

    lossaccuracy = pd.DataFrame(columns=['testdatestart', 'trainloss', 'trainaccuracy', 'testloss', 'testaccuracy'])

    batch_size = 256
    num_classes = 3
    epochs = 10

    for count in range(int((len(tradecalander3year)-125)/shiftday)-1): #125天的历史数据作为训练集，滚动测试
        print(count)
        # count=0
        traindate = tradecalander3year[count*shiftday : 125+count*shiftday]
        testdate = tradecalander3year[125+(count+1)*shiftday : 125+ (count+2)*shiftday]#10天更新一次模型，因为Y无法获取，所以要注意训练时间段和预测时间段的中间的间隔
        print(testdate[0])

        positivesample_train = getsample(positivesampleall, traindate)
        positivesample_test  = getsample(positivesampleall, testdate)
        negativesample_train = getsample(negativesampleall, traindate)
        negativesample_test  = getsample(negativesampleall, testdate)
        flatsample_train = getsample(flatsampleall, traindate)
        flatsample_test = getsample(flatsampleall, testdate)

        x_train = np.concatenate((positivesample_train, flatsample_train, negativesample_train))
        y_train = np.concatenate((np.zeros(len(positivesample_train)), np.ones(len(flatsample_train)), 2 * np.ones(len(negativesample_train))))
        x_test = np.concatenate((positivesample_test, flatsample_test, negativesample_test))
        y_test = np.concatenate((np.zeros(len(positivesample_test)), np.ones(len(flatsample_test)), 2 * np.ones(len(negativesample_test))))

        # convert class vectors to binary class matrices
        y_train = keras.utils.to_categorical(y_train, num_classes)
        y_test  = keras.utils.to_categorical(y_test, num_classes)

        # Another way to build your neural net
        model = Sequential([
            Dense(x_train.shape[1], input_shape=(x_train.shape[1],)),
            BatchNormalization(),
            Activation('relu'),
            Dropout(0.5),

            Dense(200),
            BatchNormalization(),
            Activation('relu'),
            Dropout(0.5),

            Dense(200),
            BatchNormalization(),
            Activation('relu'),
            Dropout(0.5),

            Dense(200),
            BatchNormalization(),
            Activation('relu'),
            Dropout(0.5),

            Dense(128),
            BatchNormalization(),
            Activation('relu'),
            Dropout(0.5),

            Dense(num_classes),
            Activation('softmax'),
        ])

        model.compile(loss='categorical_crossentropy',
                      optimizer=RMSprop(),
                      metrics=['accuracy'])

        timestart = time.time()
        history = model.fit(x_train, y_train,
                            batch_size=batch_size,
                            epochs=epochs,
                            verbose=2,
                            validation_data=(x_test, y_test))

        timeend = time.time()
        print(timeend - timestart, 's')

        # 统计loss和accuracy
        score_train = model.evaluate(x_train, y_train, verbose=0)
        score_test = model.evaluate(x_test, y_test, verbose=0)
        try:
            lossaccuracy = pd.concat([lossaccuracy, pd.DataFrame(
                [[testdate[0], score_train[0], score_train[1], score_test[0], score_test[1]]],
                columns=['testdatestart', 'trainloss', 'trainaccuracy', 'testloss', 'testaccuracy'])])
        except:
            pass

        model.save('E:/data/guangfamiddle/model/modelcount' + str(count) + '.h5')  # HDF5文件，pip install h5py
        keras.backend.clear_session()  #Destroys the current TF graph and creates a new one.  Useful to avoid clutter from old models / layers.
    cp.dump(lossaccuracy, open('E:/data/guangfamiddle/lossaccuracy.pkl','wb'))
def gettop():
    selected = {}  # 将每天选出来的股票放进去
    selected_negative = {}  # 将预测效果比较差的股票拉出来，比较一下，看看分类效果如何
    selected_flat = {}  # 将预测平稳的股票也拉出来

    for count in range(int((len(tradecalander3year) - 125) / shiftday) - 1):  # 125天的历史数据作为训练集，滚动测试
        # count=0
        testdate = tradecalander3year[125 + (count + 1) * shiftday: 125 + (count + 2) * shiftday]  # 10天更新一次模型，因为Y无法获取，所以要注意训练时间段和预测时间段的中间的间隔
        print(count); print(testdate[0])
        model = load_model('E:/data/guangfamiddle/model/modelcount' + str(count) + '.h5')

        # plotting the prediction, 对于要预测的未来10天，逐日进行预测，得到每天要选择的股票
        for date in testdate:
            # date = '20160413'
            a = zz800sampleall[date]
            c= model.predict(np.array(a))
            e = pd.DataFrame(c, index=a.index)
            b = pd.DataFrame(np.zeros(shape=c.shape), index=a.index)
            for i in a.index:
                if np.max(np.array(e.loc[i])) > 0.4:  #预测时，只有当概率大于50%时，才认为是该类，否则就相当于不对其进行分类，即不明显属于某类
                    b.loc[i][np.argmax(np.array(e.loc[i]))] = 1
            selected[date] = b[b[0] == 1].index.tolist()  #selected中的股票持仓10天， 在date收盘的时候选出股票，并买入的
            selected_flat[date] = b[b[1] == 1].index.tolist()
            selected_negative[date] = b[b[2] == 1].index.tolist()
        keras.backend.clear_session()  # Destroys the current TF graph and creates a new one.  Useful to avoid clutter from old models / layers.
    cp.dump(selected, open('E:/data/guangfamiddle/selected.pkl','wb'))
    cp.dump(selected_flat, open('E:/data/guangfamiddle/selected_flat.pkl','wb'))
    cp.dump(selected_negative, open('E:/data/guangfamiddle/selected_negative.pkl','wb'))
    return selected, selected_flat, selected_negative
getmodel() #第一部分是获取模型，
selected, selected_flat, selected_negative = gettop()
lossaccuracy = cp.load(open('E:/data/guangfamiddle/lossaccuracy.pkl','rb')) #获取模型精度

# 5.把仓位分为10个等分，每天都调仓
timestart = time.time()
a = tradecalander3year + [np.nan]*(len(tradecalander3year)%shiftday)# 将日期分为10组,其实就是将资金分成了10组
dategroupall = pd.DataFrame(np.array(a).reshape((int(len(a)/shiftday),shiftday)))
def getselectedcumprod(selected, flag='positive'):
    selectedstockreturncumprod = pd.DataFrame()
    positivedecisionaccuracy = pd.DataFrame()
    for i in range(shiftday): #妈的，还挺麻烦的
        # i= 0
        groupname = 'group' + str(i)
        print(groupname)
        stockhold = {}  # 每份资金每天的持仓情况
        a = dategroupall[i].tolist()
        jj = '0'
        count = 0
        for j in tradecalander3year[:-1]:
            count = count +1
            if j in set(selected.keys())&set(a):
                jj = j
                stockhold[tradecalander3year[count]] = selected[j]  #注意：在date收盘的时候选出股票，并买入的，所以selected之后，相当于要到第二天才开始持有
                continue
            else:
                if jj == '0':
                    stockhold[tradecalander3year[count]] = []
                else:
                    stockhold[tradecalander3year[count]] = selected[jj]
        #得到每天的持仓情况之后，开始计算大家的收益率。。每天所有的股票均等权分配
        selectedstockreturn_group = pd.Series(index=stockhold.keys())
        for date in stockhold.keys():
            selectedstockreturn_group[date] = pct_change.loc[date][stockhold[date]].mean()
        selectedstockreturn_groupcumprod = (selectedstockreturn_group + 1.0).cumprod()
        selectedstockreturn_groupcumprod = pd.DataFrame(selectedstockreturn_groupcumprod, columns=[groupname])
        selectedstockreturncumprod = pd.concat([selectedstockreturncumprod, selectedstockreturn_groupcumprod],axis=1)  #把10组资金每日的表现保存起来

    #     计算买入信号决策精度，买入的股票，每天收益率为正的比例
        positivedecisionaccuracy_group = pd.Series(index=stockhold.keys())
        for date in stockhold.keys():
            # date = '20180503'
            if sum(pct_change.loc[date][stockhold[date]]!=0) != 0:
                if flag == 'positive':
                    positivedecisionaccuracy_group[date] = sum(pct_change.loc[date][stockhold[date]]>0)/sum(pct_change.loc[date][stockhold[date]]!=0)  #信号决策精度。
                elif flag == 'negative':
                    positivedecisionaccuracy_group[date] = sum(pct_change.loc[date][stockhold[date]]<0)/sum(pct_change.loc[date][stockhold[date]]!=0)  #信号决策精度。
            else:
                positivedecisionaccuracy_group[date] = np.nan
        positivedecisionaccuracy_group = pd.DataFrame(positivedecisionaccuracy_group,columns=[groupname])
        positivedecisionaccuracy = pd.concat([positivedecisionaccuracy, positivedecisionaccuracy_group],axis=1)#分组每日的决策精度

    return selectedstockreturncumprod, positivedecisionaccuracy
selectedstockreturncumprod, positivedecisionaccuracy_daily = getselectedcumprod(selected, 'positive')
selectedstockreturncumprod_flat, flatdecisionaccuracy_daily = getselectedcumprod(selected_flat, 'positive')
selectedstockreturncumprod_negative, negativedecisionaccuracy_daily = getselectedcumprod(selected_negative, 'negative')
timeend = time.time()
print(timeend-timestart,'s')
cp.dump(selectedstockreturncumprod, open('E:/data/guangfamiddle/selectedstockreturncumprod.pkl','wb'));cp.dump(selectedstockreturncumprod_flat, open('E:/data/guangfamiddle/selectedstockreturncumprod_flat.pkl','wb'));cp.dump(selectedstockreturncumprod_negative, open('E:/data/guangfamiddle/selectedstockreturncumprod_negative.pkl','wb'))
cp.dump(positivedecisionaccuracy_daily, open('E:/data/guangfamiddle/positivedecisionaccuracy.pkl','wb'));cp.dump(flatdecisionaccuracy_daily, open('E:/data/guangfamiddle/flatdecisionaccuracy.pkl','wb'));cp.dump(negativedecisionaccuracy_daily, open('E:/data/guangfamiddle/negativedecisionaccuracy.pkl','wb'))

positivedecisionaccuracy_daily.mean()
flatdecisionaccuracy_daily.mean()
negativedecisionaccuracy_daily.mean()

# 6.业绩评价，选中的股票未来10天为正的比例
pct_change_cumprod10 = pct_change.rolling(window=shiftday, min_periods=shiftday).apply(lambda x: ((1+x).cumprod()-1)[-1]).shift(-shiftday)
def caldecisionaccuracy_cumprod10(selected, flag = 'positive'):
    positivedecisionaccuracy_cumprod10 = pd.Series(index=selected.keys())
    for date in selected.keys():
        # date = '20171116'
        if sum(pct_change_cumprod10.loc[date][selected[date]]!=0) != 0 and sum(pd.isnull(pct_change_cumprod10.loc[date][selected[date]])) != len(selected[date]):
            if flag == 'positive':
                positivedecisionaccuracy_cumprod10[date] = sum(pct_change_cumprod10.loc[date][selected[date]]>0)/sum(pct_change_cumprod10.loc[date][selected[date]]!=0)#信号决策精度
            elif flag == 'negative':
                positivedecisionaccuracy_cumprod10[date] = sum(pct_change_cumprod10.loc[date][selected[date]]<0)/sum(pct_change_cumprod10.loc[date][selected[date]]!=0)#信号决策精度
        else:
            positivedecisionaccuracy_cumprod10[date] = np.nan
    return positivedecisionaccuracy_cumprod10
positivedecisionaccuracy_cumprod10 = caldecisionaccuracy_cumprod10(selected, 'positive');flatdecisionaccuracy_cumprod10 = caldecisionaccuracy_cumprod10(selected_flat, 'positive');negativedecisionaccuracy_cumprod10 = caldecisionaccuracy_cumprod10(selected_negative, 'negative')
cp.dump(positivedecisionaccuracy_cumprod10, open('E:/data/guangfamiddle/positivedecisionaccuracy_cumprod10.pkl','wb'));cp.dump(flatdecisionaccuracy_cumprod10, open('E:/data/guangfamiddle/flatdecisionaccuracy_cumprod10.pkl','wb'));cp.dump(negativedecisionaccuracy_cumprod10, open('E:/data/guangfamiddle/negativedecisionaccuracy_cumprod10.pkl','wb'))

positivedecisionaccuracy_cumprod10[positivedecisionaccuracy_cumprod10!=0].mean()
flatdecisionaccuracy_cumprod10[flatdecisionaccuracy_cumprod10!=0].mean()
negativedecisionaccuracy_cumprod10[negativedecisionaccuracy_cumprod10!=0].mean()


# 7.可视化。画图,分别分开画，与合在一起画
zz800index = pd.read_pickle('E:/data/guangfamiddle/zz800index.pkl')
def getselectedzz800compare(selectedstockreturncumprod,classified):
    selectedstockreturncumprod.index = pd.to_datetime(selectedstockreturncumprod.index)
    returncumprod = selectedstockreturncumprod.mean(axis=1)
    zz800index.index = pd.to_datetime(zz800index.index)
    a= pd.concat([returncumprod,(zz800index[returncumprod.dropna().index[0] : returncumprod.dropna().index[-1]]+1).cumprod()],axis=1,join='inner')
    a.columns = [classified, 'zz800']
    a.plot();plt.show()
getselectedzz800compare(selectedstockreturncumprod, 'positive');getselectedzz800compare(selectedstockreturncumprod_flat, 'flat');getselectedzz800compare(selectedstockreturncumprod_negative, 'negative')

def getselectedzz800compareall(selectedstockreturncumprod,selectedstockreturncumprod_flat,selectedstockreturncumprod_negative):
    selectedstockreturncumprod.index = pd.to_datetime(selectedstockreturncumprod.index)
    returncumprodpositive = selectedstockreturncumprod.mean(axis=1)
    selectedstockreturncumprod_flat.index = pd.to_datetime(selectedstockreturncumprod_flat.index)
    returncumprodflat = selectedstockreturncumprod_flat.mean(axis=1)
    selectedstockreturncumprod_negative.index = pd.to_datetime(selectedstockreturncumprod_negative.index)
    returncumprodnegative = selectedstockreturncumprod_negative.mean(axis=1)
    zz800index.index = pd.to_datetime(zz800index.index)
    a = pd.concat([returncumprodpositive, returncumprodflat, returncumprodnegative, (zz800index[returncumprodpositive.dropna().index[0] : returncumprodpositive.dropna().index[-1]] + 1).cumprod()], axis=1, join='inner')
    a.columns = [ 'positive', 'flat', 'negative', 'zz800']
    a.plot(figsize=(17,10));plt.show()
    return  a
getselectedzz800compareall = getselectedzz800compareall(selectedstockreturncumprod,selectedstockreturncumprod_flat,selectedstockreturncumprod_negative)
getselectedzz800compareall.mean(axis = 0)

getselectedzz800compareall.max()

# zz800index.plot(figsize=(17, 10));plt.show()











# lossaccuracy.set_index('testdatestart').plot()
# plt.show()












